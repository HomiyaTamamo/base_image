const imageInput=document.getElementById("imageInput"),compressBtn=document.getElementById("compressBtn"),decompressBtn=document.getElementById("decompressBtn"),imageCanvas=document.getElementById("imageCanvas"),downloadLink=document.getElementById("downloadLink"),txtInput=document.getElementById("txtInput"),outputImage=document.getElementById("outputImage"),ctx=imageCanvas.getContext("2d");function runLengthEncode(t,e,n){let a=`${e} ${n}\n`,o=null,d=0;for(let e=0;e<t.length;e+=4){const n=`${t[e]},${t[e+1]},${t[e+2]}`;n===o?d++:(null!==o&&(a+=`${o},${d}\n`),o=n,d=1)}return null!==o&&(a+=`${o},${d}\n`),a}compressBtn.addEventListener("click",(()=>{if(!imageInput.files.length)return void alert("Please select an image first!");const t=imageInput.files[0],e=new FileReader;e.onload=t=>{const e=new Image;e.onload=()=>{const t=e.naturalWidth,n=e.naturalHeight;imageCanvas.width=t,imageCanvas.height=n,ctx.drawImage(e,0,0,t,n);const a=runLengthEncode(ctx.getImageData(0,0,t,n).data,t,n),o=new Blob([a],{type:"text/plain"}),d=URL.createObjectURL(o);downloadLink.href=d,downloadLink.download="compressed_image_rle.txt",downloadLink.style.display="block",downloadLink.textContent="Download Compressed TXT"},e.src=t.target.result},e.readAsDataURL(t)})),decompressBtn.addEventListener("click",(()=>{txtInput.style.display="block",txtInput.addEventListener("change",(()=>{const t=txtInput.files[0];if(!t)return void alert("Please select a .txt file!");const e=new FileReader;e.onload=t=>{const e=t.target.result.split("\n"),[n,a]=e[0].split(" ").map(Number);imageCanvas.width=n,imageCanvas.height=a;const o=ctx.createImageData(n,a);let d=0;e.slice(1).forEach((t=>{const e=t.split(","),n=Number(e[0]),a=Number(e[1]),l=Number(e[2]),s=Number(e[3]);for(let t=0;t<s;t++)o.data[d]=n,o.data[d+1]=a,o.data[d+2]=l,o.data[d+3]=255,d+=4})),ctx.putImageData(o,0,0);const l=imageCanvas.toDataURL();outputImage.src=l,outputImage.style.display="block"},e.readAsText(t)}))}));